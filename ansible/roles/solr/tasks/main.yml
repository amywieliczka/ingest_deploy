---
# tasks file for provision_solr
# already have setup solr from geerlinguy, now customize
- name: pull ingest solr code to local box
  sudo: no
  local_action: git repo=https://github.com/ucldc/solr_api.git dest={{ dir_code }}/solr_api
- name: copy solr.xml
  copy: src={{ dir_code }}/solr_api/solr.xml dest={{ solr_path }} force=yes backup=yes
- name: copy zoo.cfg
  copy: src={{ dir_code }}/solr_api/zoo.cfg dest={{ solr_path }}/solr force=yes backup=yes
- name: copy example collection files to dc-collection
  shell: >
    cp -rp {{ solr_path }}example/solr/collection1/* {{ solr_path }}/cores/dc-collection
    creates={{ solr_path }}/cores/README.txt
    cp -R {{ solr_path }}/example/multicore {{ solr_path }}/cores
- name: place core.properties in place
  copy:
    src: {{ dir_code }}/solr_api/dc-collection/core.properties
    dest: {{ solr_path }}/cores/dc-collection/core.properties
    force: yes
    backup: yes
- name: place schema in place
  copy:
    src: {{ dir_code }}/solr_api/dc-collection/conf/schema.xml
    dest: {{ solr_path }}/cores/dc-collection/conf/schema.xml
    force: yes
    backup: yes
- name: place solrconfig in place
  template:
    src: {{ dir_code }}/solr_api/dc-collection/conf/solrconfig.xml.j2
    dest: {{ solr_path }}/cores/dc-collection/conf/solrconfig.xml.j2
    force: yes
    backup: yes
